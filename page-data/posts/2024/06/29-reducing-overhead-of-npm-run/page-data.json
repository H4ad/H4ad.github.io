{"componentChunkName":"component---src-pauliescanlon-gatsby-theme-terminal-layouts-source-layout-js","path":"/posts/2024/06/29-reducing-overhead-of-npm-run/","result":{"data":{"mdx":{"id":"0f40850b-55c3-5822-8671-811ef3022bde","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Reducing overhead of npm run\",\n  \"date\": \"2024-06-29T00:00:00.000Z\",\n  \"dateModified\": \"2024-06-29T00:00:00.000Z\",\n  \"author\": \"Vinícius Lourenço\",\n  \"tags\": [\"Node.js\", \"Npm\", \"Performance\"],\n  \"featuredImage\": \"29-reducing-overhead-of-npm-run.jpg\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component '\" + name + \"' was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"small\", null, \"Photo by\", ' ', mdx(\"a\", {\n    href: \"https://unsplash.com/@marchingnapkin?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\"\n  }, \"Todd Morris\"), ' ', \"on\", ' ', mdx(\"a\", {\n    href: \"https://unsplash.com/pt-br/fotografias/um-semaforo-com-um-painel-solar-em-cima-dele-hTbEKOfXixA?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\"\n  }, \"Unsplash\")), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#introduction\"\n  }), \"Introduction\")), mdx(\"p\", null, \"This year we've had a lot of discussions about overhead of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run\"), \" and alternatives like \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://bun.sh/docs/cli/run\"\n  }), \"bun run\"), \"\\nand recently released \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/en/learn/command-line/run-nodejs-scripts-from-the-command-line\"\n  }), \"node --run\"), \" introduced by \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://x.com/yagiznizipli\"\n  }), \"@anonrig\"), \".\"), mdx(\"p\", null, \"We also had good posts about this topic, like this one by Marvin Hagemeister \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://marvinh.dev/blog/speeding-up-javascript-ecosystem-part-4/\"\n  }), \"Speeding up the JavaScript ecosystem - npm scripts\"), \",\\nwhich showed some optimization opportunities I used to improve \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run\"), \" overhead.\"), mdx(\"p\", null, \"All of these discussions motivated me to investigate the overhead of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run\"), \" and see if I could reduce it, and here's what I found.\"), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#baseline\"\n  }), \"Baseline\")), mdx(\"p\", null, \"First, let's create a simple script to measure the overhead of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"{\\n  \\\"scripts\\\": {\\n    \\\"echo\\\": \\\"echo 1\\\"\\n  }\\n}\\n\")), mdx(\"p\", null, \"When I started working on this, the npm version was \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"10.5.1\"), \", if we try run this command with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/sharkdp/hyperfine\"\n  }), \"hyperfine\"), \", we will get the following result:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ hyperfine --warmup 3 \\\"npm run echo\\\"\\nBenchmark 1: npm run echo\\n  Time (mean \\xB1 \\u03C3):     117.1 ms \\xB1   2.7 ms    [User: 108.5 ms, System: 31.5 ms]\\n  Range (min \\u2026 max):   113.4 ms \\u2026 128.0 ms    25 runs\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If you use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://asdf-vm.com\"\n  }), \"asdf\"), \" the overhead will be higher because of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shim approach\"), \", I recommend you to use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/nvm-sh/nvm\"\n  }), \"nvm\"), \".\")), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#measuring-the-overhead\"\n  }), \"Measuring the overhead\")), mdx(\"p\", null, \"To start measuring the overhead, I used the flag \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"--cpu-prof\"), \" and got the following graph representing the first \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"60ms\"), \" of executing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run echo\"), \" command:\"), mdx(\"a\", {\n    href: \"/images/posts/2024/06/npm-10-5-1-cpu-prof.png\",\n    target: \"_blank\"\n  }, mdx(\"img\", {\n    style: {\n      width: '100%'\n    },\n    src: \"/images/posts/2024/06/npm-10-5-1-cpu-prof.png\",\n    alt: \"The initial overhead of npm run using --cpu-prof\"\n  })), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The chart was generated using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vscode\"), \", just open the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".cpuprofile\"), \" file, and click in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"show flame graph\"), \" icon on top-right.\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Module._load\"), \" functions represent the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cjs loader\"), \" of Node.js, this means we are spending a lot of time loading \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cjs\"), \" modules.\"), mdx(\"p\", null, \"But just in this graph, we can't see what is being loaded, so since I am familiar with the Node.js codebase, why not emit some trace data in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Module._load\"), \" function to see what is being loaded?\"), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#improving-the-tooling\"\n  }), \"Improving the tooling\")), mdx(\"p\", null, \"My initial attempt to generate some tracing data for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Module._load\"), \" gave me the following result:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-plain\"\n  }), \"MODULE 1484165: TIMING [...shortened.../node_modules/make-fetch-happen/lib/cache/index.js] [./entry.js]: 44.579735 ms\\nMODULE 1484165: TIMING [...shortened.../node_modules/make-fetch-happen/lib/fetch.js] [./cache/index.js]: 45.353002000000004 ms\\nMODULE 1484165: TIMING [...shortened.../node_modules/make-fetch-happen/lib/index.js] [./fetch.js]: 48.313565999999994 ms\\nMODULE 1484165: TIMING [...shortened.../node_modules/npm-registry-fetch/lib/index.js] [make-fetch-happen]: 49.179769 ms\\nMODULE 1484165: TIMING [...shortened.../lib/utils/replace-info.js] [npm-registry-fetch]: 66.43049099999999 ms\\nMODULE 1484165: TIMING [...shortened.../lib/utils/error-message.js] [./replace-info.js]: 66.59006400000001 ms\\nMODULE 1484165: TIMING [...shortened.../lib/utils/exit-handler.js] [./error-message.js]: 77.62554 ms\\nMODULE 1484165: TIMING [...shortened.../lib/cli-entry.js] [./utils/exit-handler.js]: 89.835263 ms\\nMODULE 1484165: TIMING [] [...shortened.../bin/npm-cli.js]: 122.78886299999999 ms\\n\")), mdx(\"p\", null, \"This was so helpful that I opened a PR on Node.js to land this as a feature:\"), mdx(\"a\", {\n    href: \"https://github.com/nodejs/node/pull/52213\",\n    target: \"_blank\",\n    rel: \"noopener\"\n  }, mdx(\"img\", {\n    style: {\n      maxWidth: '100%'\n    },\n    src: \"/images/posts/2024/06/print-load-time-pr.jpeg\",\n    alt: \"PR to print amount of load time of a module\"\n  })), mdx(\"p\", null, \"With help of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/joyeecheung\"\n  }), \"Joyee Cheung\"), \", we improved this feature to emit \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"trace_events\"), \", that produces a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JSON\"), \" file that can be visualized in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome://tracing\"), \".\"), mdx(\"p\", null, \"This PR was landed on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/nodejs/node/pull/53379\"\n  }), \"v22.3.0\"), \", and you can use it with the following command:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ node --trace-event-categories node.module_timer --trace-event-file-pattern 'trace-events.log' your-script.js\\n\")), mdx(\"p\", null, \"Then import the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"trace-events.log\"), \" file into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome://tracing\"), \" and you will get a graph like this:\"), mdx(\"a\", {\n    href: \"/images/posts/2024/06/npm-run-tracing.png\",\n    target: \"_blank\"\n  }, mdx(\"img\", {\n    style: {\n      width: '100%'\n    },\n    src: \"/images/posts/2024/06/npm-run-tracing.png\",\n    alt: \"Using the new feature to trace the load time of a module\"\n  })), mdx(\"p\", null, \"Now we have everything we need to start optimizing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run\"), \".\"), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#lazy-loading-dependencies\"\n  }), \"Lazy-loading dependencies\")), mdx(\"p\", null, \"All the dependencies of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm\"), \" are loaded for a reason, and we can't just remove them, but we can try to load them lazily.\"), mdx(\"p\", null, \"To lazy load a dependency on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"commonjs\"), \" is very simple, let's use the following image as example:\"), mdx(\"a\", {\n    href: \"/images/posts/2024/06/example-of-lazy-loading.png\",\n    target: \"_blank\"\n  }, mdx(\"img\", {\n    style: {\n      width: '100%'\n    },\n    src: \"/images/posts/2024/06/example-of-lazy-loading.png\",\n    alt: \"In the image, we moved the require function of the dependency we want to lazy-load from the top of the script to be called only when needed.\"\n  })), mdx(\"p\", null, \"In the image, we moved the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"require\"), \" of the dependency we want to lazy-load from the top of the script to be called only when needed.\"), mdx(\"p\", null, \"Using this pattern, I started looking for all dependencies, one by one, that could be lazy-loaded, and I got the following PRs:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/cli\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7314\"\n  }), \"perf: avoid importing npm-registry-fetch for replace-info\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This one was superseded by \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7334\"\n  }), \"this PR\"), \".\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/package-json\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/package-json/pull/87\"\n  }), \"fix(perf): lazy load un-common dependencies for npm run\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/cli\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7346\"\n  }), \"fix(perf): avoid importing the entire semver package for update-notifier\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/cli\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7347\"\n  }), \"fix: lazy load validate npm package name on error message\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/package-json\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/package-json/pull/88\"\n  }), \"perf: only import necessary functions from semver\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"builtins\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/juliangruber/builtins/pull/53\"\n  }), \"perf: only import used function from semver\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/cli\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7352\"\n  }), \"fix(perf): lazy load workspace dependency\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/cli\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7359\"\n  }), \"fix(perf): only import what is needed for type-defs\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/cli\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7360\"\n  }), \"fix(perf): only initialize workpaces when we are inside a workspace\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/package-json\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/package-json/pull/89\"\n  }), \"fix(perf): lazy load glob on normalize.js \")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm/package-json\"), \" \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/npm/package-json/pull/90\"\n  }), \"fix(perf): lazy load hosted git info on normalize\"))), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#results\"\n  }), \"Results\")), mdx(\"p\", null, \"All these PRs was released on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm@10.5.2\"), \", and if we run the same benchmark again, we will get the following result:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ npm i -g npm@10.5.2\\n$ hyperfine --warmup 3 \\\"npm run echo\\\"\\nBenchmark 1: npm run echo\\n  Time (mean \\xB1 \\u03C3):      87.9 ms \\xB1   1.3 ms    [User: 77.0 ms, System: 23.9 ms]\\n  Range (min \\u2026 max):    86.3 ms \\u2026  92.3 ms    33 runs\\n\")), mdx(\"p\", null, \"Also, after a huge refactor on terminal display functionalities by \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://x.com/lukekarrys\"\n  }), \"Luke Karrys\"), \" on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/npm/cli/pull/7339\"\n  }), \"this PR\"), \", on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm@10.6.0\"), \" we got another improvement:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ npm i -g npm@10.6.0\\n$ hyperfine --warmup 3 \\\"npm run echo\\\"\\nBenchmark 1: npm run echo\\n  Time (mean \\xB1 \\u03C3):      79.6 ms \\xB1   0.8 ms    [User: 71.3 ms, System: 19.5 ms]\\n  Range (min \\u2026 max):    78.2 ms \\u2026  81.8 ms    37 runs\\n\")), mdx(\"p\", null, \"In total, we went from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"117ms\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"80ms\"), \", which represents a 46% improvement in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run\"), \" overhead.\"), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#what-about-the-alternatives\"\n  }), \"What about the alternatives?\")), mdx(\"p\", null, \"In case you are wondering, what if we compare it to other tools like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"bun run\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node --run\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pnpm\"), \", well, here is the result:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ hyperfine --warmup 3 \\\"npm run echo\\\" \\\"node --run echo\\\" \\\"pnpm run echo\\\" \\\"bun run echo\\\"\\nBenchmark 1: npm run echo\\n  Time (mean \\xB1 \\u03C3):      81.8 ms \\xB1   1.1 ms    [User: 70.6 ms, System: 20.1 ms]\\n  Range (min \\u2026 max):    80.3 ms \\u2026  84.8 ms    36 runs\\n\\nBenchmark 2: node --run echo\\n  Time (mean \\xB1 \\u03C3):       4.2 ms \\xB1   0.4 ms    [User: 2.0 ms, System: 2.3 ms]\\n  Range (min \\u2026 max):     3.5 ms \\u2026   5.6 ms    568 runs\\n\\n  Warning: Command took less than 5 ms to complete. Results might be inaccurate.\\n\\nBenchmark 3: pnpm run echo\\n  Time (mean \\xB1 \\u03C3):     285.2 ms \\xB1   3.2 ms    [User: 254.3 ms, System: 48.4 ms]\\n  Range (min \\u2026 max):   281.4 ms \\u2026 290.5 ms    10 runs\\n\\nBenchmark 4: bun run echo\\n  Time (mean \\xB1 \\u03C3):       5.4 ms \\xB1   0.4 ms    [User: 2.0 ms, System: 3.5 ms]\\n  Range (min \\u2026 max):     4.7 ms \\u2026   6.9 ms    424 runs\\n\\n  Warning: Command took less than 5 ms to complete. Results might be inaccurate.\\n\\nSummary\\n  'node --run echo' ran\\n    1.31 \\xB1 0.15 times faster than 'bun run echo'\\n   19.67 \\xB1 1.71 times faster than 'npm run echo'\\n   68.56 \\xB1 5.93 times faster than 'pnpm run echo'\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"For this latest command, I used npm v10.8.1, bun v1.1.17, node v22.3.0 and pnpm v9.4.0\")), mdx(\"h2\", null, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#conclusion\"\n  }), \"Conclusion\")), mdx(\"p\", null, \"I want to thank the NPM team, especially \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://x.com/lukekarrys\"\n  }), \"Luke Karrys\"), \"\\nand \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/wraithgar\"\n  }), \"@wraithgar\"), \" for helping me get all these PRs.\"), mdx(\"p\", null, \"Optimizing NPM is not an easy task as the world (and many versions of Node.js) depend on it,\\nand even small mistakes or premature optimizations can break the world, so I have huge respect for the NPM team for doing this work.\"), mdx(\"p\", null, \"Also, not all improvements should be merged, and that's okay.\\nWe need to be careful with the trade-offs we are making, my optimizations were focused on making as few changes as possible\\nwhile keeping the codebase maintainable and readable. Sometimes saving 5ms isn't worth the added complexity to the codebase, I had a good example of that in \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/jslicense/spdx-correct.js/pull/43\"\n  }), \"this PR\"), \".\"), mdx(\"p\", null, \"There is a huge ocean of improvements that can be made to the JS ecosystem that are waiting to be explored,\\nand I hope this post can inspire and also give some tips on how to start exploring this ocean.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Introduction This year we've had a lot of discussions about overhead of  npm run  and alternatives like  bun run \nand recently released…","timeToRead":3,"wordCount":{"words":760},"frontmatter":{"title":"Reducing overhead of npm run","tags":["Node.js","Npm","Performance"],"date":"2024-06-29T00:00:00.000Z","dateModified":"2024-06-29T00:00:00.000Z","author":"Vinícius Lourenço","status":null,"isPrivate":null,"url":null,"misc":null,"featuredImage":{"childImageSharp":{"original":{"width":640,"height":480,"src":"/static/29-reducing-overhead-of-npm-run-cc16213635d2dd93be0d1fc0290f0f0c.jpg"},"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAED/9oADAMBAAIQAxAAAAHNoWk6THE//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAECEQMh/9oACAEBAAEFAqdW+fLD0nEN6z//xAAXEQADAQAAAAAAAAAAAAAAAAABAhAR/9oACAEDAQE/AQuz/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AVyf/8QAGRAAAgMBAAAAAAAAAAAAAAAAACEBESBR/9oACAEBAAY/Ar6MUY//xAAaEAEAAgMBAAAAAAAAAAAAAAABAEERITFh/9oACAEBAAE/IdQsHk9JE8s4QdN3LCduf//aAAwDAQACAAMAAAAQqw//xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQMBAT8QQNpl/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxBRuR0v/8QAHBABAQEAAgMBAAAAAAAAAAAAAREAIUExYbHR/9oACAEBAAE/EExS2t4G6mWSP5qOh4uiGuQF2yosp0fMxqTz73//2Q==","aspectRatio":1.3333333333333333,"src":"/static/cc16213635d2dd93be0d1fc0290f0f0c/55d72/29-reducing-overhead-of-npm-run.jpg","srcSet":"/static/cc16213635d2dd93be0d1fc0290f0f0c/b3cab/29-reducing-overhead-of-npm-run.jpg 300w,\n/static/cc16213635d2dd93be0d1fc0290f0f0c/39f27/29-reducing-overhead-of-npm-run.jpg 600w,\n/static/cc16213635d2dd93be0d1fc0290f0f0c/55d72/29-reducing-overhead-of-npm-run.jpg 640w","sizes":"(max-width: 640px) 100vw, 640px"},"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAED/9oADAMBAAIQAxAAAAHNoWk6THE//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAECEQMh/9oACAEBAAEFAqdW+fLD0nEN6z//xAAXEQADAQAAAAAAAAAAAAAAAAABAhAR/9oACAEDAQE/AQuz/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AVyf/8QAGRAAAgMBAAAAAAAAAAAAAAAAACEBESBR/9oACAEBAAY/Ar6MUY//xAAaEAEAAgMBAAAAAAAAAAAAAAABAEERITFh/9oACAEBAAE/IdQsHk9JE8s4QdN3LCduf//aAAwDAQACAAMAAAAQqw//xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQMBAT8QQNpl/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxBRuR0v/8QAHBABAQEAAgMBAAAAAAAAAAAAAREAIUExYbHR/9oACAEBAAE/EExS2t4G6mWSP5qOh4uiGuQF2yosp0fMxqTz73//2Q==","width":400,"height":300,"src":"/static/cc16213635d2dd93be0d1fc0290f0f0c/64b17/29-reducing-overhead-of-npm-run.jpg","srcSet":"/static/cc16213635d2dd93be0d1fc0290f0f0c/64b17/29-reducing-overhead-of-npm-run.jpg 1x,\n/static/cc16213635d2dd93be0d1fc0290f0f0c/39f27/29-reducing-overhead-of-npm-run.jpg 1.5x"},"id":"02146500-dd96-59e3-9cb6-f964990395d0"}},"embeddedImages":null},"fields":{"slug":"/posts/2024/06/29-reducing-overhead-of-npm-run/","owner":"source","parent":"posts"}}},"pageContext":{"id":"0f40850b-55c3-5822-8671-811ef3022bde","prev":null,"next":{"frontmatter":{"title":"From a million invocations to thousand with correct caching","status":null},"fields":{"slug":"/posts/2022/12/08-from-million-invocations-to-thousand-with-correct-caching/"}},"parent":"posts"}},"staticQueryHashes":["1469902088","1756707795","1826328981"]}